å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¸®ç”¨æˆ·å†™ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼Œç”¨æˆ·å·²ç»æä¾›äº†ä»–ä»¬çš„ä»£ç ï¼Œå¹¶ä¸”ä¹‹å‰çš„å¯¹è¯ä¸­è®¨è®ºäº†å¦‚ä½•ç»“åˆå‚æ•°ç¼“å­˜å®ç°å•ä¾‹æ¨¡å¼ã€‚é¦–å…ˆï¼Œæˆ‘è¦ç†è§£ç”¨æˆ·æä¾›çš„ä»£ç çš„åŠŸèƒ½ï¼Œç„¶åæ ¹æ®å¸¸è§çš„READMEç»“æ„æ¥ç»„ç»‡å†…å®¹ã€‚

é¦–å…ˆï¼Œç”¨æˆ·çš„é¡¹ç›®æ˜¯ä¸€ä¸ªåä¸ºkeyed-singletonçš„npmåŒ…ï¼Œå®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®ä¸åŒçš„å‚æ•°ç¼“å­˜å®ä¾‹ï¼Œå®ç°å¤šä¾‹æ¨¡å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸åŒçš„å‚æ•°ä¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹ï¼Œä¸åŒçš„å‚æ•°ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ã€‚ç”¨æˆ·ä¹‹å‰è®¨è®ºè¿‡å¦‚ä½•ä»£ç†æ„é€ å‡½æ•°å’Œæ™®é€šå‡½æ•°ï¼Œä½¿ç”¨Proxyæ¥æ‹¦æˆªconstructå’Œapplyæ–¹æ³•ï¼Œå¹¶ä¸”ç”¨Mapæ¥ç¼“å­˜å®ä¾‹ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦ç¡®å®šREADMEçš„ç»“æ„ã€‚é€šå¸¸åŒ…æ‹¬æ ‡é¢˜ã€ç®€ä»‹ã€å®‰è£…ã€ä½¿ç”¨ç¤ºä¾‹ã€APIæ–‡æ¡£ã€æ³¨æ„äº‹é¡¹ã€è´¡çŒ®å’Œè®¸å¯è¯ç­‰éƒ¨åˆ†ã€‚ç”¨æˆ·å¯èƒ½å¸Œæœ›çªå‡ºæ˜¾ç¤ºåŠŸèƒ½ã€å®‰è£…æ­¥éª¤ã€ä½¿ç”¨ç¤ºä¾‹å’ŒAPIè¯´æ˜ã€‚

æ ‡é¢˜éƒ¨åˆ†åº”è¯¥æ˜ç¡®ï¼Œæ¯”å¦‚keyed-singletonï¼ŒåŠ ä¸Šç®€çŸ­çš„æè¿°ï¼Œæ¯”å¦‚å‚æ•°æ„ŸçŸ¥çš„å•ä¾‹/å¤šä¾‹æ¨¡å¼ç®¡ç†å·¥å…·ã€‚ç®€ä»‹éƒ¨åˆ†è¦è¯´æ˜è¿™ä¸ªåº“çš„ä½œç”¨ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæ¯”å¦‚æ ¹æ®å‚æ•°ç®¡ç†å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

å®‰è£…éƒ¨åˆ†å¾ˆç®€å•ï¼Œå°±æ˜¯npm installçš„å‘½ä»¤ã€‚ä½¿ç”¨ç¤ºä¾‹éœ€è¦å±•ç¤ºç±»æ„é€ å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„ä½¿ç”¨ï¼Œä»¥åŠå‚æ•°ä¸åŒæ—¶çš„è¡Œä¸ºã€‚ç”¨æˆ·ä¹‹å‰æä¾›çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæœ‰Databaseç±»å’ŒcreateConnectionå‡½æ•°ï¼Œè¿™äº›å¯ä»¥ä½œä¸ºç¤ºä¾‹ã€‚

APIæ–‡æ¡£éœ€è¦è¯¦ç»†è¯´æ˜å¯¼å‡ºçš„singletonå‡½æ•°ï¼Œå‚æ•°å’Œè¿”å›å€¼ï¼Œä»¥åŠç±»å‹å®šä¹‰ã€‚æ³¨æ„äº‹é¡¹éƒ¨åˆ†è¦æåˆ°å‚æ•°åºåˆ—åŒ–çš„ç»†èŠ‚ï¼Œæ¯”å¦‚å¯¹è±¡å±æ€§çš„é¡ºåºå’Œç±»å‹å¤„ç†ï¼Œä»¥åŠå¾ªç¯å¼•ç”¨çš„é™åˆ¶ã€‚å¯èƒ½è¿˜éœ€è¦æåˆ°æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚å‚æ•°å¤æ‚æ—¶çš„å½±å“ã€‚

è´¡çŒ®å’Œè®¸å¯è¯éƒ¨åˆ†é€šå¸¸æ˜¯æ ‡å‡†å†…å®¹ï¼Œé¼“åŠ±è´¡çŒ®å’ŒMITè®¸å¯è¯ã€‚ç”¨æˆ·å¯èƒ½éœ€è¦è°ƒæ•´è®¸å¯è¯ï¼Œä½†é€šå¸¸MITæ¯”è¾ƒé€šç”¨ã€‚

å¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›READMEåŒ…å«ä¸€äº›å¾½ç« ï¼Œæ¯”å¦‚npmç‰ˆæœ¬ã€ä¸‹è½½é‡ã€æ„å»ºçŠ¶æ€ç­‰ï¼Œä½†ç”¨æˆ·æ²¡æœ‰æä¾›è¿™äº›ä¿¡æ¯ï¼Œå¯èƒ½æš‚æ—¶ä¸éœ€è¦ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æˆ·æä¾›çš„serializeArgså‡½æ•°ä½¿ç”¨JSON.stringifyå¹¶æ’åºå¯¹è±¡é”®ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ä¸å¯åºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆå¦‚åŒ…å«å‡½æ•°æˆ–å¾ªç¯å¼•ç”¨ï¼‰ä¼šå‡ºé”™ï¼Œè¿™äº›éœ€è¦åœ¨æ³¨æ„äº‹é¡¹ä¸­è¯´æ˜ã€‚

è¿˜è¦æ£€æŸ¥ä»£ç ä¸­çš„ç±»å‹å®šä¹‰æ˜¯å¦æ­£ç¡®ï¼Œæ¯”å¦‚Constructorå’ŒAnyFunctionç±»å‹æ˜¯å¦åœ¨READMEä¸­æ­£ç¡®æè¿°ã€‚ç”¨æˆ·ä¹‹å‰çš„ä»£ç æœ‰ç±»å‹å®šä¹‰ï¼Œéœ€è¦åœ¨APIæ–‡æ¡£éƒ¨åˆ†å‡†ç¡®åæ˜ ã€‚

æœ€åï¼Œç¡®ä¿è¯­è¨€ç®€æ´æ˜äº†ï¼Œç¤ºä¾‹ä»£ç æ­£ç¡®ï¼Œå¹¶ä¸”ç»“æ„æ¸…æ™°ï¼Œæ–¹ä¾¿å…¶ä»–å¼€å‘è€…ç†è§£å’Œä½¿ç”¨è¿™ä¸ªåº“ã€‚




```markdown
# keyed-singleton ğŸ—ï¸

[![npm version](https://img.shields.io/npm/v/keyed-singleton)](https://www.npmjs.com/package/keyed-singleton)
[![bundle size](https://img.shields.io/bundlephobia/minzip/keyed-singleton)](https://bundlephobia.com/package/keyed-singleton)

æ™ºèƒ½å‚æ•°æ„ŸçŸ¥çš„å•ä¾‹/å¤šä¾‹æ¨¡å¼ç®¡ç†å·¥å…·ï¼Œæ ¹æ®åˆå§‹åŒ–å‚æ•°è‡ªåŠ¨ç¼“å­˜å®ä¾‹ã€‚

## ç‰¹æ€§

- ğŸ§© **åŒæ¨¡å¼æ”¯æŒ**ï¼šåŒæ—¶å¤„ç†ç±»æ„é€ å‡½æ•°å’Œæ™®é€šå‡½æ•°
- ğŸ” **æ·±åº¦å‚æ•°æ„ŸçŸ¥**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸åŒå‚æ•°ç»„åˆåˆ›å»ºç‹¬ç«‹å®ä¾‹
- ğŸ“¦ **é›¶ä¾èµ–**ï¼šä»…ä½¿ç”¨åŸç”ŸProxyå’ŒMapå®ç°
- ğŸ¦¾ **å®Œå…¨ç±»å‹åŒ–**ï¼šå®Œå–„çš„TypeScriptç±»å‹æ”¯æŒ

## å®‰è£…

```bash
npm install keyed-singleton
```

## ä½¿ç”¨ç¤ºä¾‹

### ç±»æ„é€ å‡½æ•°æ¨¡å¼
```typescript
import { singleton } from 'keyed-singleton';

class Database {
  constructor(public config: { url: string }) {}
}

const CachedDB = singleton(Database);

// ç›¸åŒå‚æ•°è¿”å›åŒä¸€å®ä¾‹
const db1 = new CachedDB({ url: 'mysql://localhost' });
const db2 = new CachedDB({ url: 'mysql://localhost' });
console.log(db1 === db2); // true

// ä¸åŒå‚æ•°åˆ›å»ºæ–°å®ä¾‹
const db3 = new CachedDB({ url: 'postgres://prod' });
console.log(db1 === db3); // false
```

### å·¥å‚å‡½æ•°æ¨¡å¼
```typescript
const createConnection = (config: { timeout: number }) => ({
  ...config,
  status: 'connected'
});

const getConnection = singleton(createConnection);

// ç›¸åŒå‚æ•°å¤ç”¨å®ä¾‹
const conn1 = getConnection({ timeout: 1000 });
const conn2 = getConnection({ timeout: 1000 });
console.log(conn1 === conn2); // true

// å‚æ•°å·®å¼‚è§¦å‘æ–°å®ä¾‹
const conn3 = getConnection({ timeout: 2000 });
console.log(conn1 === conn3); // false
```

## API

### `singleton<T>(target)`
```typescript
export function singleton<T extends object>(
  target: Constructor<T> | AnyFunction<T>
): Constructor<T> | AnyFunction<T>
```

#### ç±»å‹å®šä¹‰
```typescript
type Constructor<T = any> = new (...args: any[]) => T;
type AnyFunction<T = any> = (...args: any[]) => T;
```

#### å‚æ•°
| å‚æ•°    | ç±»å‹                    | è¯´æ˜                |
|---------|-------------------------|-------------------|
| target  | `Constructor` \| `AnyFunction` | éœ€è¦ç¼“å­˜å®ä¾‹çš„ç±»æˆ–å‡½æ•° |

#### è¿”å›å€¼
è¿”å›ç»è¿‡ä»£ç†çš„ç±»/å‡½æ•°ï¼Œå…·æœ‰å‚æ•°æ„ŸçŸ¥çš„å®ä¾‹ç¼“å­˜èƒ½åŠ›

## å·¥ä½œåŸç†

1. **å‚æ•°åºåˆ—åŒ–**  
   ä½¿ç”¨æ·±åº¦ç¨³å®šåºåˆ—åŒ–ç®—æ³•å¤„ç†å‚æ•°ï¼š
   - å¯¹è±¡å±æ€§æŒ‰å­—æ¯é¡ºåºæ’åº
   - åµŒå¥—ç»“æ„é€’å½’å¤„ç†
   - éå¯¹è±¡ç±»å‹ç›´æ¥ä¿ç•™

2. **ç¼“å­˜ç­–ç•¥**  
   ```mermaid
   graph TD
     A[è°ƒç”¨æ„é€ å‡½æ•°/å‡½æ•°] --> B{å‚æ•°ç¼“å­˜å­˜åœ¨?}
     B -- æ˜¯ --> C[è¿”å›ç¼“å­˜å®ä¾‹]
     B -- å¦ --> D[åˆ›å»ºæ–°å®ä¾‹]
     D --> E[åºåˆ—åŒ–å‚æ•°å¹¶ç¼“å­˜]
     E --> C
   ```

## æ³¨æ„äº‹é¡¹

1. **å‚æ•°ç¨³å®šæ€§**  
   ä»¥ä¸‹æƒ…å†µä¼šè¢«è§†ä¸ºä¸åŒå‚æ•°ï¼š
   ```typescript
   // å¯¹è±¡å±æ€§é¡ºåºä¸åŒ
   getConnection({ a: 1, b: 2 }) vs getConnection({ b: 2, a: 1 })
   
   // æ•°ç»„é¡ºåºä¸åŒ
   new CachedService([1, 2]) vs new CachedService([2, 1])
   ```

2. **ä¸å¯åºåˆ—åŒ–ç±»å‹**  
   ä»¥ä¸‹ç±»å‹ä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆï¼š
   ```typescript
   // åŒ…å«å‡½æ•°
   getConnection({ handler: () => {} })

   // å¾ªç¯å¼•ç”¨å¯¹è±¡
   const obj = { self: {} };
   obj.self = obj;
   ```

3. **æ€§èƒ½å»ºè®®**  
   å¯¹äºé«˜é¢‘è°ƒç”¨åœºæ™¯ï¼Œå»ºè®®ï¼š
   - ä½¿ç”¨ç®€å•å‚æ•°ç±»å‹
   - å¯¹å¤æ‚å¯¹è±¡å‚æ•°è¿›è¡Œé¢„å¤„ç†
   - è€ƒè™‘LRUç¼“å­˜ç­–ç•¥æ‰©å±•

## è´¡çŒ®

æ¬¢è¿æäº¤issueå’ŒPRï¼è¯·å…ˆé˜…è¯»[è´¡çŒ®æŒ‡å—](CONTRIBUTING.md)ã€‚

## è®¸å¯è¯

MIT Â© [ä½ çš„åå­—]
```

---

è¿™ä¸ªREADMEåŒ…å«ï¼š
1. ç›´è§‚çš„å¾½ç« æ˜¾ç¤ºåŒ…çŠ¶æ€
2. å¯äº¤äº’çš„ä»£ç ç¤ºä¾‹
3. Mermaidæµç¨‹å›¾è¯´æ˜å·¥ä½œåŸç†
4. ç±»å‹å®‰å…¨çš„APIæ–‡æ¡£
5. æ³¨æ„äº‹é¡¹çš„å¯¹æ¯”ç¤ºä¾‹
6. æ¸…æ™°çš„ç›®å½•ç»“æ„

å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ·»åŠ ï¼š
â€¢ æ€§èƒ½åŸºå‡†æµ‹è¯•æ•°æ®
â€¢ ä¸å…¶ä»–æµè¡Œåº“çš„å¯¹æ¯”è¡¨æ ¼
â€¢ æµè§ˆå™¨/Node.jså…¼å®¹æ€§è¯´æ˜
â€¢ å…·ä½“çš„å¼€å‘æŒ‡å—æ–‡æ¡£é“¾æ¥